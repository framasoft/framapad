image: framasoft/vuefs:latest
stages:
  - deploy

pages:
  stage: deploy
  script:
  - npm install
  - npm run preview
  - mv -f public/$CI_PROJECT_NAME/* public
  artifacts:
    paths:
    - public
  cache:
    paths:
      - node_modules/

# Push new translations strings to https://trad.framasoft.org
trads:
  stage: deploy
  image: framasoft/push-trad:latest
  script:
  - sed -e "s@<project-version>.*</project-version>@<project-version>$CI_COMMIT_REF_SLUG</project-version>@" -i zanata.xml
  - if [ ! -z ${ZANATA_CONFIG_FRAMABOT+x} ]; then mkdir -p ${HOME}/.config; echo -e "${ZANATA_CONFIG_FRAMABOT}" > ${HOME}/.config/zanata.ini; fi
  - if [ ! -z ${ZANATA_CONFIG_FRAMABOT+x} ]; then make push-locales; fi
  only:
    - master
trads2:
  stage: deploy
  image: framasoft/push-trad:latest
  script:
  - echo $CI_COMMIT_REF_SLUG
